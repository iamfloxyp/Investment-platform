<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Settings - FinBloom</title>
  <link rel="stylesheet" href="../assets/css/style.css">
  <link rel="stylesheet" href="../assets/css/dashboard.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    .settings-container {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 20px;
      margin: 20px;
    }
    .card {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }
    .user-card {
      text-align: center;
    }
    .avatar-wrapper {
      position: relative;
      width: 200px;
      height: 200px;
      margin: 10px auto;
    }
    .avatar {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid #2563eb;
      background: #f0f0f0;
      display: block;
    }
    .avatar-icon {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 120px;
      color: #9ca3af;
      pointer-events: none;
    }
    .btn-upload {
      display: block;
      margin: 10px auto 0;
      background: #2563eb;
      color: #fff;
      border: none;
      padding: 8px 15px;
      border-radius: 6px;
      cursor: pointer;
    }
    .details-card input {
      width: 100%;
      margin-bottom: 10px;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .btn-row {
      display: flex;
      gap: 10px;
    }
    .btn {
      padding: 8px 15px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .btn-edit { background: #f59e0b; color: white; }
    .btn-save { background: #2563eb; color: white; display: none; }
    .success-msg {
      margin-top: 10px;
      font-size: 14px;
      color: green;
      display: none;
    }
  </style>
</head>
<body>
  <!-- NAVIGATION BAR -->
  <header class="navbar">
    <div class="nav-container">
      <div class="logo"><a href="dashboard.html">FinBloom</a></div>
      <nav class="nav-links" id="navLinks">
        <a href="dashboard.html">Dashboard</a>
        <a href="add-deposit.html">Add Deposit</a>
        <a href="withdraw.html">Withdraw</a>
        <a href="deposit.html">Deposit</a>
        <a href="portfolio.html">Portfolio</a>
        <a href="history.html">History</a>
        <a href="referrals.html">Referrals</a>
        <a href="settings.html" class="active">Settings</a>
      </nav>
      <div class="nav-right">
        <div class="notifications">
          <span class="bell">üîî</span>
          <span class="badge">3</span>
        </div>
        <div class="user-menu">
          <button class="user-btn" id="userBtn">User ‚ñæ</button>
          <div class="dropdown" id="dropdownMenu">
            <a href="dashboard.html">Dashboard</a>
            <a href="../pages/index.html#contact">Support</a>
            <a href="login.html">Logout</a>
          </div>
        </div>
        <button class="menu-toggle" onclick="toggleMenu()">‚ò∞</button>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main>
    <h1 style="margin:20px;">Welcome, <span id="welcomeName">User</span> üëã</h1>

    <div class="settings-container">
      <!-- User card -->
      <div class="card user-card">
        <h3 id="userName">User</h3>
        <div class="avatar-wrapper">
          <img id="userAvatar" class="avatar" src="" alt="User Avatar">
          <i id="avatarIcon" class="fa fa-user-circle avatar-icon"></i>
        </div>
        <input type="file" id="avatarUpload" accept="image/*" style="display:none;">
        <button class="btn-upload" onclick="document.getElementById('avatarUpload').click()">Change Photo</button>
        <p id="regDate">Registration: </p>
        <p id="userEmail">user@example.com</p>
        <div class="success-msg" id="avatarMsg">Avatar updated successfully!</div>
      </div>

      <!-- Personal Details -->
      <div class="card details-card">
        <h4>Personal Details</h4>
        <input type="text" id="fullName" placeholder="Full Name" disabled>
        <input type="email" id="email" placeholder="Email" disabled>
        <input type="password" id="newPassword" placeholder="New Password" disabled>
        <input type="password" id="rePassword" placeholder="Retype Password" disabled>
        <div class="btn-row">
          <button class="btn btn-edit" onclick="editSection('personal')">Edit</button>
          <button class="btn btn-save" id="savePersonal" onclick="saveSection('personal')">Save</button>
        </div>
        <div class="success-msg" id="personalMsg">Personal details updated successfully!</div>
      </div>

      <!-- Payment Details -->
      <div class="card details-card">
        <h4>Payment Details</h4>
        <label>Bitcoin Wallet</label>
        <input type="text" id="btcWallet" disabled>
        <label>Ethereum Wallet</label>
        <input type="text" id="ethWallet" disabled>
        <label>USDT Wallet</label>
        <input type="text" id="usdtWallet" disabled>
        <label>Bank Account</label>
        <input type="text" id="bankAccount" disabled>
        <label>PayPal</label>
        <input type="text" id="paypalAccount" disabled>
        <div class="btn-row">
          <button class="btn btn-edit" onclick="editSection('payment')">Edit</button>
          <button class="btn btn-save" id="savePayment" onclick="saveSection('payment')">Save</button>
        </div>
        <div class="success-msg" id="paymentMsg">Payment details updated successfully!</div>
      </div>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="site-footer">
    <div class="container footer-grid">
      <div class="f-brand">
        <a href="dashboard.html" class="f-logo"><img src="../assets/images/logo.png" alt="FinBloom" /></a>
        <p class="f-tag">Smart investing for a brighter future.</p>
      </div>
      <div class="f-col">
        <h4>Quick Links</h4>
        <ul class="f-links">
          <li><a href="portfolio.html">Portfolio</a></li>
          <li><a href="deposits.html">My Deposits</a></li>
          <li><a href="withdraw.html">Withdraw</a></li>
          <li><a href="settings.html">Settings</a></li>
        </ul>
      </div>
      <div class="f-col">
        <h4>Legal</h4>
        <ul class="f-links">
          <li><a href="#">Privacy Policy</a></li>
          <li><a href="#">Terms of Service</a></li>
          <li><a href="#">Security</a></li>
        </ul>
      </div>
      <div class="f-col">
        <h4>Contact</h4>
        <ul class="f-links f-contact">
          <li><a href="mailto:support@finbloom.com">support@finbloom.com</a></li>
          <li><a href="tel:+15551234567">+1 (555) 123-4567</a></li>
        </ul>
      </div>
    </div>
    <div class="subfooter">
      <div class="container subfooter-row">
        <p>¬©Ô∏è <span id="year"></span> FinBloom. All rights reserved.</p>
      </div>
    </div>
  </footer>

  
    <script>
  document.getElementById("year").textContent = new Date().getFullYear();

  document.addEventListener("DOMContentLoaded", () => {
    let user = JSON.parse(localStorage.getItem("user")) || {
      name: "User",
      email: "user@example.com",
      regDate: new Date().toLocaleString(),
      avatar: "",
      wallets: { btc: "", eth: "", usdt: "", bank: "", paypal: "" }
    };

    // ‚úÖ Pull saved wallets from localStorage keys if they exist
    if (localStorage.getItem("wallets")) {
      user.wallets = JSON.parse(localStorage.getItem("wallets"));
    }

    // save defaults if new
    if (!localStorage.getItem("user")) {
      localStorage.setItem("user", JSON.stringify(user));
    }

    // === Populate UI ===
    document.getElementById("welcomeName").textContent = user.name;
    document.getElementById("userName").textContent = user.name;
    document.getElementById("userEmail").textContent = user.email;
    document.getElementById("regDate").textContent = "Registration: " + user.regDate;

    document.getElementById("fullName").value = user.name;
    document.getElementById("email").value = user.email;

    // Populate Payment Details from withdraw keys
document.getElementById("btcWallet").value   = localStorage.getItem("withdraw_btc")   || "";
document.getElementById("ethWallet").value   = localStorage.getItem("withdraw_eth")   || "";
document.getElementById("usdtWallet").value  = localStorage.getItem("withdraw_usdt")  || "";
document.getElementById("bankAccount").value = localStorage.getItem("withdraw_bank")  || "";
document.getElementById("paypalAccount").value = localStorage.getItem("withdraw_paypal") || "";

// Save Payment Details back to withdraw keys
if(section === "payment"){
  localStorage.setItem("withdraw_btc",   document.getElementById("btcWallet").value);
  localStorage.setItem("withdraw_eth",   document.getElementById("ethWallet").value);
  localStorage.setItem("withdraw_usdt",  document.getElementById("usdtWallet").value);
  localStorage.setItem("withdraw_bank",  document.getElementById("bankAccount").value);
  localStorage.setItem("withdraw_paypal",document.getElementById("paypalAccount").value);

  document.getElementById("paymentMsg").style.display = "block";
  document.getElementById("savePayment").style.display = "none";
  ["btcWallet","ethWallet","usdtWallet","bankAccount","paypalAccount"].forEach(id=>{
    document.getElementById(id).disabled = true;
  });
}
    if (user.avatar) {
      document.getElementById("userAvatar").src = user.avatar;
      document.getElementById("userAvatar").style.display = "block";
      document.getElementById("avatarIcon").style.display = "none";
    } else {
      document.getElementById("userAvatar").style.display = "none";
      document.getElementById("avatarIcon").style.display = "block";
    }

    // Avatar upload
    document.getElementById("avatarUpload").addEventListener("change", e => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = ev => {
          user.avatar = ev.target.result;
          localStorage.setItem("user", JSON.stringify(user));
          document.getElementById("userAvatar").src = ev.target.result;
          document.getElementById("userAvatar").style.display = "block";
          document.getElementById("avatarIcon").style.display = "none";
          document.getElementById("avatarMsg").style.display = "block";
          setTimeout(() => document.getElementById("avatarMsg").style.display = "none", 10000);
        };
        reader.readAsDataURL(file);
      }
    });
  });

  function editSection(section) {
    if (section === "personal") {
      ["fullName", "email", "newPassword", "rePassword"].forEach(id => {
        document.getElementById(id).disabled = false;
      });
      document.getElementById("savePersonal").style.display = "inline-block";
    }
    if (section === "payment") {
      ["btcWallet", "ethWallet", "usdtWallet", "bankAccount", "paypalAccount"].forEach(id => {
        document.getElementById(id).disabled = false;
      });
      document.getElementById("savePayment").style.display = "inline-block";
    }
  }

  function saveSection(section) {
    let user = JSON.parse(localStorage.getItem("user"));
    if (section === "personal") {
      user.name = document.getElementById("fullName").value;
      user.email = document.getElementById("email").value;
      localStorage.setItem("user", JSON.stringify(user));
      document.getElementById("personalMsg").style.display = "block";
      setTimeout(() => document.getElementById("personalMsg").style.display = "none", 10000);
      document.getElementById("savePersonal").style.display = "none";
      ["fullName", "email", "newPassword", "rePassword"].forEach(id => {
        document.getElementById(id).disabled = true;
      });
    }
    if (section === "payment") {
      user.wallets = {
        btc: document.getElementById("btcWallet").value,
        eth: document.getElementById("ethWallet").value,
        usdt: document.getElementById("usdtWallet").value,
        bank: document.getElementById("bankAccount").value,
        paypal: document.getElementById("paypalAccount").value
      };
      localStorage.setItem("user", JSON.stringify(user));
      // ‚úÖ Also store wallets separately so withdraw page can read it
      localStorage.setItem("wallets", JSON.stringify(user.wallets));
      document.getElementById("paymentMsg").style.display = "block";
      setTimeout(() => document.getElementById("paymentMsg").style.display = "none", 10000);
      document.getElementById("savePayment").style.display = "none";
      ["btcWallet", "ethWallet", "usdtWallet", "bankAccount", "paypalAccount"].forEach(id => {
        document.getElementById(id).disabled = true;
      });
    }
  }

  </script>
  <script src="../assets/js/dashboard.js"></script>
</body>
</html>